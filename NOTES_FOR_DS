***) IMPORTANT
Do starport scaffold chain github.com/supsi-dacd-isaac/cosmos-apps/pm outside Goland and the delete pm/.git and pm/.github folders

***) HOW TO QUERY THE SIDECHAIN EXPOSING NOTHING ON THE REST API:
To query the sidechain in the application without exposing in the REST API the related part in protobuf files must be commented, see below:

Example (MeasureAll is usable in the application but not implemented for the external API as GET request):
	// Queries a list of measure items.
	rpc MeasureAll(QueryAllMeasureRequest) returns (QueryAllMeasureResponse) {
    //	option (google.api.http).get = "/supsi-dacd-isaac/tsdb/tsdb/measure";
	}

***) USEFUL TRANSACTIONS FOR PM:

pmd keys list
- name: dstreppa
  type: local
  address: cosmos1p4rx2hjq2kka688kn0c8y0eltk2hnyn3tj342s
  pubkey: '{"@type":"/cosmos.crypto.secp256k1.PubKey","key":"A5kXPpbq6QPLldE8MH8EWa9cjYW93AXS5t21T262Yuix"}'
  mnemonic: ""


* IMPORTANT: The only difference between scaffold list and map command is that in "map" you can define
               the identifier field (called index), instead in "list" is created automatically

***) Scaffold commands
starport scaffold single dso idx:string address:string
starport scaffold single aggregator idx:string address:string

starport scaffold map player idx:string address:string role:string

starport scaffold map lem start:int end:int params players
starport scaffold map lemMeasure player:string signal:string timestamp:int value:string mu:string

starport scaffold map sla start:int end:int
starport scaffold map kpi sla:string rule:string limit:string mu:string penalty:int
starport scaffold map kpiMeasure kpi:string player:string timestamp:int value:string mu:string

***) DSO and Aggregator
pmd tx pm create-dso aem cosmos1p4rx2hjq2kka688kn0c8y0eltk2hnyn3tj342s --from dstreppa -y
pmd tx pm create-aggregator lic cosmos1p4rx2hjq2kka688kn0c8y0eltk2hnyn3tj342s --from dstreppa -y

curl -X GET "http://localhost:1317/supsi-dacd-isaac/pm/pm/dso"
curl -X GET "http://localhost:1317/supsi-dacd-isaac/pm/pm/aggregator"

***) Player data sink
N.B. aem is the index in the following row (AEM is a pseudonym)
pmd tx pm create-player aem cosmos1p4rx2hjq2kka688kn0c8y0eltk2hnyn3tj342s dso --from dstreppa -y
pmd tx pm create-player lic cosmos1p4rx2hjq2kka688kn0c8y0eltk2hnyn3tj342s aggregator --from dstreppa -y
pmd tx pm create-player pros01 addr_pros01 prosumer --from dstreppa -y
pmd tx pm create-player pros02 addr_pros02 prosumer --from dstreppa -y

curl -X GET "http://localhost:1317/supsi-dacd-isaac/pm/pm/player"
curl -X GET "http://localhost:1317/supsi-dacd-isaac/pm/pm/player/aem"

***) LEM data sink
index = start-end-aggregator

pmd tx pm create-lem 1000-1900-lic 1000 1900 green 15 7 20 5 0.2 pros01 pros02 --from dstreppa -y

curl -X GET "http://localhost:1317/supsi-dacd-isaac/pm/pm/lem"
curl -X GET "http://localhost:1317/supsi-dacd-isaac/pm/pm/lem/1000-1900-lic"

***) LEM measures data sink (oracle is the prosumer-player)
index = player-signal-timestamp (e.g. pros02-P-100)

pmd tx pm create-lem-measure pros02-P-100 pros02 P 100 125.6 W --from dstreppa -y

curl -X GET "http://localhost:1317/supsi-dacd-isaac/pm/pm/lemMeasure"
curl -X GET "http://localhost:1317/supsi-dacd-isaac/pm/pm/lemMeasure/pros02-P-100"

***) SLA data sink
index = sla

pmd tx pm create-sla sla01 1000 1900 --from dstreppa -y

curl -X GET "http://localhost:1317/supsi-dacd-isaac/pm/pm/sla"
curl -X GET "http://localhost:1317/supsi-dacd-isaac/pm/pm/sla/sla01"

***) KPI data sink
index = kpi
rule = gt | lt

pmd tx pm create-kpi kpi01 sla01 gt 3000 W 200 --from dstreppa -y

curl -X GET "http://localhost:1317/supsi-dacd-isaac/pm/pm/kpi"
curl -X GET "http://localhost:1317/supsi-dacd-isaac/pm/pm/kpi/kpi01"

***) KPI measures data sink
index = player-kpi-timestamp (e.g. pros02-P-100)

pmd tx pm create-kpi-measure pros02-kpi01-100 pros02 kpi01 100 850 W --from dstreppa -y

curl -X GET "http://localhost:1317/supsi-dacd-isaac/pm/pm/kpiMeasure"
curl -X GET "http://localhost:1317/supsi-dacd-isaac/pm/pm/kpiMeasure/pros02-kpi01-100"

***) USEFUL QUERIES:

# First two instance in player list (player should be players!!)
http://localhost:1317/supsi-dacd-isaac/pm/pm/player?pagination.limit=2
# Last two instance in player list
curl -X GET "http://localhost:1317/supsi-dacd-isaac/pm/pm/player?pagination.limit=2&pagination.reverse=true"

# Skip the first instance
curl -X GET "http://localhost:1317/supsi-dacd-isaac/pm/pm/player?pagination.offset=1"
# Show only second and third instances
curl -X GET "http://localhost:1317/supsi-dacd-isaac/pm/pm/player?pagination.offset=1&pagination.limit=2"
# Show only the third instance
curl -X GET "http://localhost:1317/supsi-dacd-isaac/pm/pm/player?pagination.offset=2&pagination.limit=1"

curl -X GET "http://localhost:1317/supsi-dacd-isaac/pm/pm/lem"
curl -X GET "http://localhost:1317/supsi-dacd-isaac/pm/pm/lem/1000

curl -X GET http://localhost:1317/cosmos/bank/v1beta1/balances/cosmos1p4rx2hjq2kka688kn0c8y0eltk2hnyn3tj342s
curl -X GET http://localhost:1317/cosmos/bank/v1beta1/balances/cosmos1p4rx2hjq2kka688kn0c8y0eltk2hnyn3tj342s/ectoken
